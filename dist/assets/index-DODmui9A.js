var C=Object.defineProperty;var p=(d,t,e)=>t in d?C(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var r=(d,t,e)=>p(d,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();function P(d,t,e,n,s){const i=(u,o)=>`${u},${o}`,h=[t],f=new Map,x=new Map;x.set(i(t.x,t.y),0);const g=(u,o)=>Math.abs(u.x-o.x)+Math.abs(u.y-o.y);for(;h.length>0;){let u=0,o=h[0],E=(x.get(i(o.x,o.y))??1/0)+g(o,e);for(let l=1;l<h.length;l++){const a=h[l],c=(x.get(i(a.x,a.y))??1/0)+g(a,e);c<E&&(u=l,o=a,E=c)}if(h.splice(u,1),o.x===e.x&&o.y===e.y){const l=[];let a=i(o.x,o.y);for(;f.has(a);){l.unshift(o);const c=f.get(a);if(!c)break;o=c,a=i(o.x,o.y)}return l}for(let l=-1;l<=1;l++)for(let a=-1;a<=1;a++){if(l===0&&a===0)continue;const c=o.x+l,m=o.y+a;if(c>=0&&c<n&&m>=0&&m<s&&!d.isBlocked(c,m)){const L=i(c,m),v=(x.get(i(o.x,o.y))??1/0)+1;v<(x.get(L)??1/0)&&(f.set(L,{x:o.x,y:o.y}),x.set(L,v),h.some(w=>w.x===c&&w.y===m)||h.push({x:c,y:m}))}}}return null}class _{constructor(t,e,n){r(this,"x");r(this,"y");r(this,"hunger",0);r(this,"tiredness",0);r(this,"state","wander");r(this,"inventory",{wood:0,flint:0,fish:0,hasShelter:!1,hasFire:!1});r(this,"currentPath",null);this.env=t,this.gridCols=e,this.gridRows=n,this.x=Math.floor(e/2),this.y=Math.floor(n/2)}getAdjacentTiles(t){const e=[];for(let n=-1;n<=t.width;n++)for(let s=-1;s<=t.height;s++)if(n===-1||n===t.width||s===-1||s===t.height){const i=t.x+n,h=t.y+s;i>=0&&i<this.gridCols&&h>=0&&h<this.gridRows&&!this.env.isBlocked(i,h)&&e.push({x:i,y:h})}return e}getAdjacentToPoint(t){const e=[];for(let n=-1;n<=1;n++)for(let s=-1;s<=1;s++){if(n===0&&s===0)continue;const i=t.x+n,h=t.y+s;i>=0&&i<this.gridCols&&h>=0&&h<this.gridRows&&!this.env.isBlocked(i,h)&&e.push({x:i,y:h})}return e}findNearest(t){if(t==="tree"){let e=1/0,n=null;for(const s of this.env.trees){const i=this.getAdjacentToPoint(s);for(const h of i){const f=Math.abs(h.x-this.x)+Math.abs(h.y-this.y);f<e&&(e=f,n=h)}}return n}if(t==="rock"){let e=1/0,n=null;for(const s of this.env.rocks){const i=this.getAdjacentToPoint(s);for(const h of i){const f=Math.abs(h.x-this.x)+Math.abs(h.y-this.y);f<e&&(e=f,n=h)}}return n}if(t==="lake"){let e=1/0,n=null;const s=this.getAdjacentTiles(this.env.lake);for(const i of s){const h=Math.abs(i.x-this.x)+Math.abs(i.y-this.y);h<e&&(e=h,n=i)}return n}return null}movePlayerRandomly(){const e=[{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1},{dx:-1,dy:0},{dx:1,dy:0},{dx:-1,dy:1},{dx:0,dy:1},{dx:1,dy:1}].sort(()=>Math.random()-.5);for(const n of e){const s=this.x+n.dx,i=this.y+n.dy;if(s>=0&&s<this.gridCols&&i>=0&&i<this.gridRows&&!this.env.isBlocked(s,i)){this.x=s,this.y=i;break}}}movePlayerToward(t){if(!this.currentPath||this.currentPath.length===0||this.currentPath[this.currentPath.length-1].x!==t.x||this.currentPath[this.currentPath.length-1].y!==t.y){const e=P(this.env,{x:this.x,y:this.y},t,this.gridCols,this.gridRows);this.currentPath=e}if(this.currentPath&&this.currentPath.length>0&&(this.currentPath[0].x===this.x&&this.currentPath[0].y===this.y&&this.currentPath.shift(),this.currentPath.length>0)){const e=this.currentPath[0];this.x=e.x,this.y=e.y,this.currentPath.shift()}}clearPath(){this.currentPath=null}performAction(){if(this.hunger=Math.min(100,this.hunger+.5),this.tiredness=Math.min(100,this.tiredness+.3),this.state==="wander"){if(this.clearPath(),this.hunger>70){this.state="fish";return}if(this.tiredness>80){this.inventory.hasShelter?!this.inventory.hasFire&&this.inventory.wood>0&&this.inventory.flint>0?this.state="rest":this.inventory.wood===0?this.state="gather_wood":this.inventory.flint===0?this.state="gather_flint":this.state="rest":this.state="build_shelter";return}this.movePlayerRandomly();return}if(this.state==="fish"){const t=this.findNearest("lake");t&&(this.x!==t.x||this.y!==t.y)?this.movePlayerToward(t):(this.clearPath(),this.inventory.fish+=1,this.hunger=Math.max(0,this.hunger-40),this.state="wander");return}if(this.state==="gather_wood"){const t=this.findNearest("tree");t&&(this.x!==t.x||this.y!==t.y)?this.movePlayerToward(t):t&&(this.clearPath(),this.inventory.wood+=1,this.state="wander");return}if(this.state==="gather_flint"){const t=this.findNearest("rock");t&&(this.x!==t.x||this.y!==t.y)?this.movePlayerToward(t):t&&(this.clearPath(),this.inventory.flint+=1,this.state="wander");return}if(this.state==="build_shelter"){this.clearPath(),this.inventory.hasShelter=!0,this.state="wander";return}if(this.state==="rest"){if(this.clearPath(),!this.inventory.hasFire&&this.inventory.wood>0&&this.inventory.flint>0){this.inventory.hasFire=!0,this.inventory.wood-=1,this.inventory.flint-=1;return}this.tiredness=Math.max(0,this.tiredness-60),this.state="wander";return}}}class S{constructor(){r(this,"BG_COLOR","#388E3C");r(this,"LAKE_COLOR","#2196F3");r(this,"ROCK_COLOR","#757575");r(this,"TREE_COLOR","#2E7D32");r(this,"PLAYER_COLOR","#FFD600");r(this,"lake",{x:5,y:5,width:4,height:2});r(this,"rocks",[{x:10,y:8},{x:12,y:15},{x:25,y:10},{x:30,y:18}]);r(this,"trees",[{x:7,y:3},{x:15,y:12},{x:20,y:5},{x:35,y:16},{x:38,y:2}])}isBlocked(t,e){if(t>=this.lake.x&&t<this.lake.x+this.lake.width&&e>=this.lake.y&&e<this.lake.y+this.lake.height)return!0;for(const n of this.rocks)if(n.x===t&&n.y===e)return!0;for(const n of this.trees)if(n.x===t&&n.y===e)return!0;return!1}}class R{constructor(t){r(this,"ctx");r(this,"animationFrameId",null);r(this,"wanderTimeoutId",null);r(this,"GRID_ROWS",20);r(this,"GRID_COLS",40);r(this,"CELL_SIZE",32);r(this,"player");r(this,"env");r(this,"loop",()=>{this.draw(),this.animationFrameId=requestAnimationFrame(this.loop)});this.canvas=t;const e=t.getContext("2d");if(!e)throw new Error("Could not get canvas context");this.ctx=e,this.env=new S,this.player=new _(this.env,this.GRID_COLS,this.GRID_ROWS)}draw(){this.ctx.fillStyle=this.env.BG_COLOR,this.ctx.fillRect(0,0,this.GRID_COLS*this.CELL_SIZE,this.GRID_ROWS*this.CELL_SIZE),this.ctx.fillStyle=this.env.LAKE_COLOR,this.ctx.fillRect(this.env.lake.x*this.CELL_SIZE,this.env.lake.y*this.CELL_SIZE,this.env.lake.width*this.CELL_SIZE,this.env.lake.height*this.CELL_SIZE),this.ctx.fillStyle=this.env.ROCK_COLOR;for(const t of this.env.rocks)this.ctx.beginPath(),this.ctx.arc(t.x*this.CELL_SIZE+this.CELL_SIZE/2,t.y*this.CELL_SIZE+this.CELL_SIZE/2,this.CELL_SIZE*.4,0,Math.PI*2),this.ctx.fill();this.ctx.fillStyle=this.env.TREE_COLOR;for(const t of this.env.trees)this.ctx.beginPath(),this.ctx.arc(t.x*this.CELL_SIZE+this.CELL_SIZE/2,t.y*this.CELL_SIZE+this.CELL_SIZE/2,this.CELL_SIZE*.45,0,Math.PI*2),this.ctx.fill();this.ctx.fillStyle=this.env.PLAYER_COLOR,this.ctx.fillRect(this.player.x*this.CELL_SIZE,this.player.y*this.CELL_SIZE,this.CELL_SIZE,this.CELL_SIZE),this.ctx.font="20px monospace",this.ctx.fillStyle="#fff",this.ctx.fillText(`Hunger: ${Math.round(this.player.hunger)}`,10,24),this.ctx.fillText(`Tired: ${Math.round(this.player.tiredness)}`,10,48),this.ctx.fillStyle="#FFD600",this.ctx.fillText(`State: ${this.player.state}`,10,72)}scheduleWander(){const t=100+Math.random()*200;this.wanderTimeoutId=window.setTimeout(()=>{this.player.performAction(),this.scheduleWander()},t)}start(){this.loop(),this.scheduleWander()}stop(){this.animationFrameId!==null&&cancelAnimationFrame(this.animationFrameId),this.wanderTimeoutId!==null&&clearTimeout(this.wanderTimeoutId)}}const y=document.createElement("canvas");y.width=40*32;y.height=20*32;y.style.border="2px solid #222";y.style.imageRendering="pixelated";y.style.display="block";y.style.margin="auto";y.style.background="#388E3C";document.body.style.background="#222";document.body.style.display="flex";document.body.style.alignItems="center";document.body.style.justifyContent="center";document.body.style.height="100vh";document.body.style.margin="0";var I;(I=document.getElementById("root"))==null||I.appendChild(y);const O=new R(y);O.start();
